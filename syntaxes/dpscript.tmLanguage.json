{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"scopeName": "source.dpscript",
	"fileTypes": [
		"dps"
	],
	"patterns": [{"include": "#any"}],
	"foldingStartMarker": "\\{",
	"foldingStopMarker": "}",
	"repository": {
		"any": {
			"patterns": [
				{"include": "#keyword"},
				{"include": "#control_kw"},
				{"include": "#selector"},
				{"include": "#var_type"},
				{"include": "#selector_member"},
				{"include": "#expression"},
				{"include": "#nbt"},
				{"include": "#raw_command"}
			]
		},
		"keyword": {
			"match": "\\b(tick|load|summon|new|print|function|block|this|class|abstract|extends|prop)\\b",
			"name": "keyword"
		},
		"control_kw": {
			"match": "\\b(if|as|at|for|offset|switch|case|else|while)\\b",
			"name": "keyword.control"
		},
		"var_type":{
			"match": "\\b(const|objective|global|int|string|boolean|selector|bossbar|double)\\b",
			"name": "entity.name.type"
		},
		"selector":{
			"match": "(\\@\\w+|\\bself\\b)(\\[.*])?",
			"captures": {
				"1":{
					"patterns": [{
						"include": "#selector_params"
					}]
				}
			},
			"name":"constant.regexp"
		},
		"selector_params": {
			"begin": "\\[",
			"patterns": [
				{"include": "#expression"},
				{"include": "#selector_param"}
			],
			"end": "]",
			"name":"variable.parameter"
		},
		"selector_param": {
			"match": "\\b(tag|tags|name|distance|limit|level)\\b",
			"name":"storage.modifier"
		},
		"expression": {
			"patterns": [
				{"include": "#string"},
				{"include": "#int"}
			]
		},
		"string": {
			"patterns": [
				{
					"begin": "\"",
					"end": "\"",
					"name":"string"
				},
				{
					"begin": "'",
					"end": "'",
					"name":"string"
				}
			]
		},
		"int": {
			"match": "[1-9]?[0-9]*\\.[0-9]*",
			"name":"constant.numeric"
		},
		"selector_member":{
			"match": "\\.(kill|give|effect|enchant|gamemode|title)\\b",
			"captures": {
				"1":{
					"name":"support.function"
				}
			}
		},
		"nbt": {
			"match": "\\{([^\n]+)}",
			"captures": {
				"1":{
					"patterns": [{"include": "#nbt_values"}]
				}
			},
			"name":"comment.line"
		},
		"nbt_values": {
			"match": "([a-zA-Z_]+)(\\:.+)?",
			"captures": {
				"1":{
					"name":"variable.name"
				},
				"2":{
					"patterns": [
						{"include": "#expression"},
						{"include": "#nbt_list"},
						{"include": "#nbt"},
						{
							"match": "-?\\d{1,3}(b|B)",
							"name":"constant.character"
						},
						{
							"match": "-?\\d{1,5}(s|S)",
							"name":"invalid.deprecated"
						},
						{
							"match": "-?\\d+(\\.\\d+)?(d|D)?",
							"name":"keyword.control.less"
						}
					]
				}
			}
		},
		"nbt_list": {
			"begin": "\\[",
			"end": "\\]",
			"name":"variable.parameter",
			"patterns": [{
				"include": "#nbt_values"
			}]
		},
		"raw_command":{
			"begin": "/",
			"end": "(\n|$)",
			"patterns": [{
				"include": "source.mcfunction"
			}]
		}
	}
}